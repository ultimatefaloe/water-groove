generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // url      = env("DATABASE_URL")
}

// =======================================
// ENUMS
// =======================================

enum AdminRole {
  ADMIN
  SUPERADMIN
}

enum InvestorTier {
  STARTER
  GROWTH
  PREMIUM
  ELITE
  EXECUTIVE
}

enum InvestmentStatus {
  PENDING_PAYMENT
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
  REJECTED
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  INTEREST
}

enum TransactionStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

// =======================================
// MODELS
// =======================================

model User {
  id       String  @id @default(uuid())
  auth0Id  String  @unique
  fullName String
  email    String  @unique
  phone    String? @unique
  picture  String?

  investorTier InvestorTier?
  isActive     Boolean       @default(true)

  investments  Investment[]
  transactions Transaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}

model Admin {
  id           String    @id @default(uuid())
  fullName     String
  email        String    @unique
  passwordHash String
  role         AdminRole @default(ADMIN)
  isActive     Boolean   @default(true)

  lastLoginAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  approvedInvestments   Investment[]
  processedTransactions Transaction[]
  platformBankAccount   PlatformBankAccount[]

  @@index([email])
  @@index([role])
}

model InvestmentCategory {
  id   String @id @default(uuid())
  name InvestorTier @unique

  minAmount Decimal  @db.Decimal(15, 2)
  maxAmount Decimal? @db.Decimal(15, 2)

  monthlyRoiRate Decimal @db.Decimal(5, 2)
  durationMonths Int

  description String?
  isActive    Boolean @default(true)

  investments Investment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive])
}

model Investment {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  categoryId String
  category   InvestmentCategory @relation(fields: [categoryId], references: [id])

  principalAmount Decimal @db.Decimal(15, 2)

  roiRateSnapshot Decimal @db.Decimal(5, 2)
  durationMonths  Int

  status InvestmentStatus @default(PENDING_PAYMENT)

  startDate DateTime?
  endDate   DateTime?

  approvedByAdminId String?
  approvedByAdmin   Admin?  @relation(fields: [approvedByAdminId], references: [id])

  transactions Transaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([categoryId])
  @@index([status])
}

model Transaction {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  investmentId String?
  investment   Investment? @relation(fields: [investmentId], references: [id])

  type   TransactionType
  status TransactionStatus @default(PENDING)

  amount      Decimal @db.Decimal(15, 2)
  proofUrl    String?
  description String?

  processedByAdminId String?
  processedByAdmin   Admin?  @relation(fields: [processedByAdminId], references: [id])

  processedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  withdrawalDetail WithdrawalDetail?

  @@index([userId])
  @@index([investmentId])
  @@index([type])
  @@index([status])
}

model WithdrawalDetail {
  id String @id @default(uuid())

  transactionId String      @unique
  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  bankName          String
  accountNumber     String
  accountHolderName String
  reference         String?

  createdAt DateTime @default(now())
}

model PlatformBankAccount {
  id String @id @default(uuid())

  bankName          String
  accountNumber     String
  accountHolderName String

  currency String @default("NGN")

  isActive Boolean @default(false)
  isDefault Boolean @default(false)

  createdByAdminId String?
  createdByAdmin   Admin? @relation(fields: [createdByAdminId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive])
  @@index([isDefault])
}
